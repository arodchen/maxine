/*
 * Copyright (c) 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package com.oracle.max.vm.ext.graal.snippets;

import static com.oracle.graal.api.code.MemoryBarriers.*;
import static com.oracle.graal.nodes.extended.MembarNode.*;

import java.util.*;

import com.oracle.graal.api.code.*;
import com.oracle.graal.api.meta.*;
import com.oracle.graal.graph.*;
import com.oracle.graal.nodes.extended.*;
import com.oracle.graal.nodes.java.*;
import com.oracle.graal.nodes.spi.*;
import com.oracle.graal.nodes.type.*;
import com.oracle.graal.snippets.*;
import com.oracle.graal.snippets.Snippet.ConstantParameter;
import com.oracle.graal.snippets.Snippet.Parameter;
import com.oracle.graal.snippets.SnippetTemplate.*;
import com.oracle.max.vm.ext.graal.*;
import com.oracle.max.vm.ext.graal.nodes.*;
import com.sun.cri.ri.*;
import com.sun.max.annotate.*;
import com.sun.max.vm.*;
import com.sun.max.vm.actor.member.*;
import com.sun.max.vm.classfile.constant.*;
import com.sun.max.vm.object.*;
import com.sun.max.vm.runtime.*;

/**
 * Snippets for field access, resolved and unresolved. The unresolved field lowerings use similar code
 * generated by {@link T1X} and makes a runtime call to do the resolution. Ideally, the code
 * sequences would be shared, however, {@code T1X} does not do volatile handling in the template for
 * resolved fields (for some reason) and also uses {@code int} and casts for {@code boolean, byte, char, short} types
 * in the templates.
 *
 * When deoptimzation for Graal works, it might be better to follow the normal Graal expectation of deoptimizing the code
 * for unresolved fields, thus leaving the resolution to {@link T1X}.
 *
 * One possible improvement to unresolved field handling would be to inline the guard check.
 *
 * The resolved snippets are very simple and actually the same for instance fields and static fields,
 * as either the static tuple or the receiver is passed as the "object", so the signatures are identical.
 *
 * Unresolved snippets are more complex, as we can't access the static tuple until the resolution has occurred,
 * and the runtime calls in the (historic) {@link Snippets} class to do the resolution are different for static
 * and instance fields. So there are separate snippets for instance and static fields. There is an intermediate
 * state where the field is resolved but the class may need to be initialized.
 *
 * However, once the resolution is done, the resolved snippet can be invoked (as runtime code) to handle the field access.
 */
public class FieldSnippets extends SnippetLowerings implements SnippetsInterface {

    @HOSTED_ONLY
    public static void registerLowerings(VMConfiguration config, TargetDescription targetDescription, MetaAccessProvider runtime, Assumptions assumptions, Map<Class< ? extends Node>, LoweringProvider> lowerings) {
        new FieldSnippets(config, targetDescription, runtime, assumptions, lowerings);
    }

    @HOSTED_ONLY
    private FieldSnippets(VMConfiguration vmConfig, TargetDescription targetDescription, MetaAccessProvider runtime, Assumptions assumptions, Map<Class< ? extends Node>, LoweringProvider> lowerings) {
        super(runtime, assumptions, targetDescription);

        LoadFieldLowering loadFieldLowering = new LoadFieldLowering();
        StoreFieldLowering storeFieldLowering = new StoreFieldLowering();

        LoadUnresolvedFieldLowering loadUnresolvedFieldLowering = new LoadUnresolvedFieldLowering();
        StoreUnresolvedFieldLowering storeUnresolvedFieldLowering = new StoreUnresolvedFieldLowering();

        LoadUnresolvedFieldLowering loadUnresolvedStaticFieldLowering = new LoadUnresolvedFieldLowering();
        StoreUnresolvedFieldLowering storeUnresolvedStaticFieldLowering = new StoreUnresolvedFieldLowering();

        LoadUnresolvedFieldLowering loadHolderInitStaticFieldLowering = new LoadUnresolvedFieldLowering();
        StoreUnresolvedFieldLowering storeHolderInitStaticFieldLowering = new StoreUnresolvedFieldLowering();
        LoadUnresolvedFieldLowering loadHolderInitInstanceFieldLowering = new LoadUnresolvedFieldLowering();
        StoreUnresolvedFieldLowering storeHolderInitInstanceFieldLowering = new StoreUnresolvedFieldLowering();

        // Can only register one lowering class per node, so the static/init variants have to be handled in an ad hoc way
        loadUnresolvedFieldLowering.staticFieldLowering = loadUnresolvedStaticFieldLowering;
        loadUnresolvedFieldLowering.initHolderStaticLowering = loadHolderInitStaticFieldLowering;
        loadUnresolvedFieldLowering.initHolderFieldLowering = loadHolderInitInstanceFieldLowering;

        storeUnresolvedFieldLowering.staticFieldLowering = storeUnresolvedStaticFieldLowering;
        storeUnresolvedFieldLowering.initHolderStaticLowering = storeHolderInitStaticFieldLowering;
        storeUnresolvedFieldLowering.initHolderFieldLowering = storeHolderInitInstanceFieldLowering;


        addSnippets(loadFieldLowering, storeFieldLowering, loadUnresolvedFieldLowering, storeUnresolvedFieldLowering);


        lowerings.put(LoadFieldNode.class, loadFieldLowering);
        lowerings.put(StoreFieldNode.class, storeFieldLowering);
        lowerings.put(LoadUnresolvedFieldNode.class, loadUnresolvedFieldLowering);
        lowerings.put(StoreUnresolvedFieldNode.class, storeUnresolvedFieldLowering);

    }

    protected abstract class FieldLowering extends Lowering {
        protected final ResolvedJavaMethod[] snippets = new ResolvedJavaMethod[Kind.values().length];

        void setSnippet(Kind kind, ResolvedJavaMethod snippet) {
            snippets[kind.ordinal()] = snippet;
        }
    }

    protected abstract class ResolvedFieldLowering extends FieldLowering {

        void lower(AccessFieldNode node) {
            FieldActor fieldActor = (FieldActor) MaxResolvedJavaField.getRiResolvedField(node.field());
            boolean isStatic = node.isStatic();
            Key key = new Key(snippets[KindMap.toGraalKind(fieldActor.kind).ordinal()]);
            key.add("isVolatile", fieldActor.isVolatile());
            Arguments args = new Arguments();
            args.add("object", isStatic ? fieldActor.holder().staticTuple() : node.object());
            args.add("offset", fieldActor.offset());
            storeFieldArg(node, args);
            instantiate(node, key, args);
        }

        protected void storeFieldArg(AccessFieldNode node, Arguments args) {
        }

    }

    protected class LoadFieldLowering extends ResolvedFieldLowering implements LoweringProvider<LoadFieldNode> {

        @Override
        public void lower(LoadFieldNode node, LoweringTool tool) {
            lower(node);
        }

    }

    protected class StoreFieldLowering extends ResolvedFieldLowering implements LoweringProvider<StoreFieldNode> {

        @Override
        public void lower(StoreFieldNode node, LoweringTool tool) {
            lower(node);
        }

        @Override
        protected void storeFieldArg(AccessFieldNode node, Arguments args) {
            args.add("value", ((StoreFieldNode) node).value());
        }
    }

    protected class UnresolvedFieldLowering extends FieldLowering {
        /**
         * Holds the snippet methods for the static variants.
         */
        UnresolvedFieldLowering staticFieldLowering;
        /**
         * Holds the snippet for class initialization and static variant.
         */
        UnresolvedFieldLowering initHolderStaticLowering;
        /**
         * Holds the snippet for class initialization and instance variant.
         */
        UnresolvedFieldLowering initHolderFieldLowering;

        void lower(AccessUnresolvedFieldNode node) {
            Key key;
            Arguments args = new Arguments();
            boolean isStatic = node.object() == null;
            int ord = node.kind().ordinal();
            RiField riField = MaxJavaField.getRiField(node.field());
            if (riField instanceof FieldActor) {
                // resolved but may need class initialization
                key = new Key(isStatic ? initHolderStaticLowering.snippets[ord] : initHolderFieldLowering.snippets[ord]);
                args.add("f", riField);
            } else {
                UnresolvedField unresolvedField = (UnresolvedField) riField;
                ResolutionGuard.InPool guard = unresolvedField.constantPool.makeResolutionGuard(unresolvedField.cpi);
                key = new Key(isStatic ? staticFieldLowering.snippets[ord] : snippets[ord]);
                args.add("guard", guard);
            }
            if (!isStatic) {
                args.add("object", node.object());
            }
            storeFieldArg(node, args);
            instantiate(node, key, args);
        }

        protected void storeFieldArg(AccessUnresolvedFieldNode node, Arguments args) {
        }

    }

    protected class LoadUnresolvedFieldLowering extends UnresolvedFieldLowering implements LoweringProvider<LoadUnresolvedFieldNode> {

        @Override
        public void lower(LoadUnresolvedFieldNode node, LoweringTool tool) {
            lower(node);
        }

    }

    protected class StoreUnresolvedFieldLowering extends UnresolvedFieldLowering implements LoweringProvider<StoreUnresolvedFieldNode> {

        @Override
        public void lower(StoreUnresolvedFieldNode node, LoweringTool tool) {
            lower(node);
        }

        @Override
        protected void storeFieldArg(AccessUnresolvedFieldNode node, Arguments args) {
            args.add("value", ((StoreUnresolvedFieldNode) node).value());
        }
    }

// START GENERATED CODE
    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static boolean loadBooleanFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_READ);
        }
        boolean result = TupleAccess.readBoolean(object, offset);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
        return result;
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeBooleanFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile, @Parameter("value") boolean value) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_WRITE);
        }
        TupleAccess.writeBoolean(object, offset, value);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
    }

    @RUNTIME_ENTRY
    public static boolean resolveAndGetFieldBoolean(ResolutionGuard.InPool guard, Object object) {
        FieldActor f = Snippets.resolveInstanceFieldForReading(guard);
        return holderInitAndGetFieldBoolean(f, object);
    }

    @RUNTIME_ENTRY
    public static boolean resolveAndGetStaticBoolean(ResolutionGuard.InPool guard) {
        FieldActor f = Snippets.resolveStaticFieldForReading(guard);
        return holderInitAndGetStaticBoolean(f);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutFieldBoolean(ResolutionGuard.InPool guard, Object object, boolean value) {
        FieldActor f = Snippets.resolveInstanceFieldForWriting(guard);
        holderInitAndPutFieldBoolean(f, object, value);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutStaticBoolean(ResolutionGuard.InPool guard, boolean value) {
        FieldActor f = Snippets.resolveStaticFieldForWriting(guard);
        holderInitAndPutStaticBoolean(f, value);
    }

    @RUNTIME_ENTRY
    public static boolean holderInitAndGetFieldBoolean(FieldActor f, Object object) {
        Snippets.makeHolderInitialized(f);
        return loadBooleanFieldSnippet(object, f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static boolean holderInitAndGetStaticBoolean(FieldActor f) {
        Snippets.makeHolderInitialized(f);
        return loadBooleanFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutFieldBoolean(FieldActor f, Object object, boolean value) {
        Snippets.makeHolderInitialized(f);
        storeBooleanFieldSnippet(object, f.offset(), f.isVolatile(), value);
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutStaticBoolean(FieldActor f, boolean value) {
        Snippets.makeHolderInitialized(f);
        storeBooleanFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile(), value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static boolean loadBooleanHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object) {
        return holderInitAndGetFieldBoolean(f, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static boolean loadBooleanHolderInitStaticSnippet(@Parameter("f") FieldActor f) {
        return holderInitAndGetStaticBoolean(f);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeBooleanHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object,
            @Parameter("value") boolean value) {
        holderInitAndPutFieldBoolean(f, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeBooleanHolderInitStaticSnippet(@Parameter("f") FieldActor f,
            @Parameter("value") boolean value) {
        holderInitAndPutStaticBoolean(f, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static boolean loadBooleanUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object) {
        return resolveAndGetFieldBoolean(guard, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static boolean loadBooleanUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard) {
        return resolveAndGetStaticBoolean(guard);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeBooleanUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object,
            @Parameter("value") boolean value) {
        resolveAndPutFieldBoolean(guard, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeBooleanUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard,
            @Parameter("value") boolean value) {
        resolveAndPutStaticBoolean(guard, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static byte loadByteFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_READ);
        }
        byte result = TupleAccess.readByte(object, offset);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
        return result;
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeByteFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile, @Parameter("value") byte value) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_WRITE);
        }
        TupleAccess.writeByte(object, offset, value);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
    }

    @RUNTIME_ENTRY
    public static byte resolveAndGetFieldByte(ResolutionGuard.InPool guard, Object object) {
        FieldActor f = Snippets.resolveInstanceFieldForReading(guard);
        return holderInitAndGetFieldByte(f, object);
    }

    @RUNTIME_ENTRY
    public static byte resolveAndGetStaticByte(ResolutionGuard.InPool guard) {
        FieldActor f = Snippets.resolveStaticFieldForReading(guard);
        return holderInitAndGetStaticByte(f);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutFieldByte(ResolutionGuard.InPool guard, Object object, byte value) {
        FieldActor f = Snippets.resolveInstanceFieldForWriting(guard);
        holderInitAndPutFieldByte(f, object, value);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutStaticByte(ResolutionGuard.InPool guard, byte value) {
        FieldActor f = Snippets.resolveStaticFieldForWriting(guard);
        holderInitAndPutStaticByte(f, value);
    }

    @RUNTIME_ENTRY
    public static byte holderInitAndGetFieldByte(FieldActor f, Object object) {
        Snippets.makeHolderInitialized(f);
        return loadByteFieldSnippet(object, f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static byte holderInitAndGetStaticByte(FieldActor f) {
        Snippets.makeHolderInitialized(f);
        return loadByteFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutFieldByte(FieldActor f, Object object, byte value) {
        Snippets.makeHolderInitialized(f);
        storeByteFieldSnippet(object, f.offset(), f.isVolatile(), value);
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutStaticByte(FieldActor f, byte value) {
        Snippets.makeHolderInitialized(f);
        storeByteFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile(), value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static byte loadByteHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object) {
        return holderInitAndGetFieldByte(f, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static byte loadByteHolderInitStaticSnippet(@Parameter("f") FieldActor f) {
        return holderInitAndGetStaticByte(f);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeByteHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object,
            @Parameter("value") byte value) {
        holderInitAndPutFieldByte(f, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeByteHolderInitStaticSnippet(@Parameter("f") FieldActor f,
            @Parameter("value") byte value) {
        holderInitAndPutStaticByte(f, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static byte loadByteUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object) {
        return resolveAndGetFieldByte(guard, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static byte loadByteUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard) {
        return resolveAndGetStaticByte(guard);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeByteUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object,
            @Parameter("value") byte value) {
        resolveAndPutFieldByte(guard, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeByteUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard,
            @Parameter("value") byte value) {
        resolveAndPutStaticByte(guard, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static short loadShortFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_READ);
        }
        short result = TupleAccess.readShort(object, offset);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
        return result;
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeShortFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile, @Parameter("value") short value) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_WRITE);
        }
        TupleAccess.writeShort(object, offset, value);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
    }

    @RUNTIME_ENTRY
    public static short resolveAndGetFieldShort(ResolutionGuard.InPool guard, Object object) {
        FieldActor f = Snippets.resolveInstanceFieldForReading(guard);
        return holderInitAndGetFieldShort(f, object);
    }

    @RUNTIME_ENTRY
    public static short resolveAndGetStaticShort(ResolutionGuard.InPool guard) {
        FieldActor f = Snippets.resolveStaticFieldForReading(guard);
        return holderInitAndGetStaticShort(f);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutFieldShort(ResolutionGuard.InPool guard, Object object, short value) {
        FieldActor f = Snippets.resolveInstanceFieldForWriting(guard);
        holderInitAndPutFieldShort(f, object, value);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutStaticShort(ResolutionGuard.InPool guard, short value) {
        FieldActor f = Snippets.resolveStaticFieldForWriting(guard);
        holderInitAndPutStaticShort(f, value);
    }

    @RUNTIME_ENTRY
    public static short holderInitAndGetFieldShort(FieldActor f, Object object) {
        Snippets.makeHolderInitialized(f);
        return loadShortFieldSnippet(object, f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static short holderInitAndGetStaticShort(FieldActor f) {
        Snippets.makeHolderInitialized(f);
        return loadShortFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutFieldShort(FieldActor f, Object object, short value) {
        Snippets.makeHolderInitialized(f);
        storeShortFieldSnippet(object, f.offset(), f.isVolatile(), value);
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutStaticShort(FieldActor f, short value) {
        Snippets.makeHolderInitialized(f);
        storeShortFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile(), value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static short loadShortHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object) {
        return holderInitAndGetFieldShort(f, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static short loadShortHolderInitStaticSnippet(@Parameter("f") FieldActor f) {
        return holderInitAndGetStaticShort(f);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeShortHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object,
            @Parameter("value") short value) {
        holderInitAndPutFieldShort(f, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeShortHolderInitStaticSnippet(@Parameter("f") FieldActor f,
            @Parameter("value") short value) {
        holderInitAndPutStaticShort(f, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static short loadShortUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object) {
        return resolveAndGetFieldShort(guard, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static short loadShortUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard) {
        return resolveAndGetStaticShort(guard);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeShortUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object,
            @Parameter("value") short value) {
        resolveAndPutFieldShort(guard, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeShortUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard,
            @Parameter("value") short value) {
        resolveAndPutStaticShort(guard, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static char loadCharFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_READ);
        }
        char result = TupleAccess.readChar(object, offset);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
        return result;
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeCharFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile, @Parameter("value") char value) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_WRITE);
        }
        TupleAccess.writeChar(object, offset, value);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
    }

    @RUNTIME_ENTRY
    public static char resolveAndGetFieldChar(ResolutionGuard.InPool guard, Object object) {
        FieldActor f = Snippets.resolveInstanceFieldForReading(guard);
        return holderInitAndGetFieldChar(f, object);
    }

    @RUNTIME_ENTRY
    public static char resolveAndGetStaticChar(ResolutionGuard.InPool guard) {
        FieldActor f = Snippets.resolveStaticFieldForReading(guard);
        return holderInitAndGetStaticChar(f);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutFieldChar(ResolutionGuard.InPool guard, Object object, char value) {
        FieldActor f = Snippets.resolveInstanceFieldForWriting(guard);
        holderInitAndPutFieldChar(f, object, value);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutStaticChar(ResolutionGuard.InPool guard, char value) {
        FieldActor f = Snippets.resolveStaticFieldForWriting(guard);
        holderInitAndPutStaticChar(f, value);
    }

    @RUNTIME_ENTRY
    public static char holderInitAndGetFieldChar(FieldActor f, Object object) {
        Snippets.makeHolderInitialized(f);
        return loadCharFieldSnippet(object, f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static char holderInitAndGetStaticChar(FieldActor f) {
        Snippets.makeHolderInitialized(f);
        return loadCharFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutFieldChar(FieldActor f, Object object, char value) {
        Snippets.makeHolderInitialized(f);
        storeCharFieldSnippet(object, f.offset(), f.isVolatile(), value);
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutStaticChar(FieldActor f, char value) {
        Snippets.makeHolderInitialized(f);
        storeCharFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile(), value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static char loadCharHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object) {
        return holderInitAndGetFieldChar(f, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static char loadCharHolderInitStaticSnippet(@Parameter("f") FieldActor f) {
        return holderInitAndGetStaticChar(f);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeCharHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object,
            @Parameter("value") char value) {
        holderInitAndPutFieldChar(f, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeCharHolderInitStaticSnippet(@Parameter("f") FieldActor f,
            @Parameter("value") char value) {
        holderInitAndPutStaticChar(f, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static char loadCharUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object) {
        return resolveAndGetFieldChar(guard, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static char loadCharUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard) {
        return resolveAndGetStaticChar(guard);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeCharUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object,
            @Parameter("value") char value) {
        resolveAndPutFieldChar(guard, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeCharUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard,
            @Parameter("value") char value) {
        resolveAndPutStaticChar(guard, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static int loadIntFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_READ);
        }
        int result = TupleAccess.readInt(object, offset);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
        return result;
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeIntFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile, @Parameter("value") int value) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_WRITE);
        }
        TupleAccess.writeInt(object, offset, value);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
    }

    @RUNTIME_ENTRY
    public static int resolveAndGetFieldInt(ResolutionGuard.InPool guard, Object object) {
        FieldActor f = Snippets.resolveInstanceFieldForReading(guard);
        return holderInitAndGetFieldInt(f, object);
    }

    @RUNTIME_ENTRY
    public static int resolveAndGetStaticInt(ResolutionGuard.InPool guard) {
        FieldActor f = Snippets.resolveStaticFieldForReading(guard);
        return holderInitAndGetStaticInt(f);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutFieldInt(ResolutionGuard.InPool guard, Object object, int value) {
        FieldActor f = Snippets.resolveInstanceFieldForWriting(guard);
        holderInitAndPutFieldInt(f, object, value);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutStaticInt(ResolutionGuard.InPool guard, int value) {
        FieldActor f = Snippets.resolveStaticFieldForWriting(guard);
        holderInitAndPutStaticInt(f, value);
    }

    @RUNTIME_ENTRY
    public static int holderInitAndGetFieldInt(FieldActor f, Object object) {
        Snippets.makeHolderInitialized(f);
        return loadIntFieldSnippet(object, f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static int holderInitAndGetStaticInt(FieldActor f) {
        Snippets.makeHolderInitialized(f);
        return loadIntFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutFieldInt(FieldActor f, Object object, int value) {
        Snippets.makeHolderInitialized(f);
        storeIntFieldSnippet(object, f.offset(), f.isVolatile(), value);
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutStaticInt(FieldActor f, int value) {
        Snippets.makeHolderInitialized(f);
        storeIntFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile(), value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static int loadIntHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object) {
        return holderInitAndGetFieldInt(f, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static int loadIntHolderInitStaticSnippet(@Parameter("f") FieldActor f) {
        return holderInitAndGetStaticInt(f);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeIntHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object,
            @Parameter("value") int value) {
        holderInitAndPutFieldInt(f, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeIntHolderInitStaticSnippet(@Parameter("f") FieldActor f,
            @Parameter("value") int value) {
        holderInitAndPutStaticInt(f, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static int loadIntUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object) {
        return resolveAndGetFieldInt(guard, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static int loadIntUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard) {
        return resolveAndGetStaticInt(guard);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeIntUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object,
            @Parameter("value") int value) {
        resolveAndPutFieldInt(guard, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeIntUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard,
            @Parameter("value") int value) {
        resolveAndPutStaticInt(guard, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static float loadFloatFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_READ);
        }
        float result = TupleAccess.readFloat(object, offset);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
        return result;
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeFloatFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile, @Parameter("value") float value) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_WRITE);
        }
        TupleAccess.writeFloat(object, offset, value);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
    }

    @RUNTIME_ENTRY
    public static float resolveAndGetFieldFloat(ResolutionGuard.InPool guard, Object object) {
        FieldActor f = Snippets.resolveInstanceFieldForReading(guard);
        return holderInitAndGetFieldFloat(f, object);
    }

    @RUNTIME_ENTRY
    public static float resolveAndGetStaticFloat(ResolutionGuard.InPool guard) {
        FieldActor f = Snippets.resolveStaticFieldForReading(guard);
        return holderInitAndGetStaticFloat(f);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutFieldFloat(ResolutionGuard.InPool guard, Object object, float value) {
        FieldActor f = Snippets.resolveInstanceFieldForWriting(guard);
        holderInitAndPutFieldFloat(f, object, value);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutStaticFloat(ResolutionGuard.InPool guard, float value) {
        FieldActor f = Snippets.resolveStaticFieldForWriting(guard);
        holderInitAndPutStaticFloat(f, value);
    }

    @RUNTIME_ENTRY
    public static float holderInitAndGetFieldFloat(FieldActor f, Object object) {
        Snippets.makeHolderInitialized(f);
        return loadFloatFieldSnippet(object, f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static float holderInitAndGetStaticFloat(FieldActor f) {
        Snippets.makeHolderInitialized(f);
        return loadFloatFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutFieldFloat(FieldActor f, Object object, float value) {
        Snippets.makeHolderInitialized(f);
        storeFloatFieldSnippet(object, f.offset(), f.isVolatile(), value);
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutStaticFloat(FieldActor f, float value) {
        Snippets.makeHolderInitialized(f);
        storeFloatFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile(), value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static float loadFloatHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object) {
        return holderInitAndGetFieldFloat(f, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static float loadFloatHolderInitStaticSnippet(@Parameter("f") FieldActor f) {
        return holderInitAndGetStaticFloat(f);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeFloatHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object,
            @Parameter("value") float value) {
        holderInitAndPutFieldFloat(f, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeFloatHolderInitStaticSnippet(@Parameter("f") FieldActor f,
            @Parameter("value") float value) {
        holderInitAndPutStaticFloat(f, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static float loadFloatUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object) {
        return resolveAndGetFieldFloat(guard, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static float loadFloatUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard) {
        return resolveAndGetStaticFloat(guard);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeFloatUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object,
            @Parameter("value") float value) {
        resolveAndPutFieldFloat(guard, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeFloatUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard,
            @Parameter("value") float value) {
        resolveAndPutStaticFloat(guard, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static long loadLongFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_READ);
        }
        long result = TupleAccess.readLong(object, offset);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
        return result;
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeLongFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile, @Parameter("value") long value) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_WRITE);
        }
        TupleAccess.writeLong(object, offset, value);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
    }

    @RUNTIME_ENTRY
    public static long resolveAndGetFieldLong(ResolutionGuard.InPool guard, Object object) {
        FieldActor f = Snippets.resolveInstanceFieldForReading(guard);
        return holderInitAndGetFieldLong(f, object);
    }

    @RUNTIME_ENTRY
    public static long resolveAndGetStaticLong(ResolutionGuard.InPool guard) {
        FieldActor f = Snippets.resolveStaticFieldForReading(guard);
        return holderInitAndGetStaticLong(f);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutFieldLong(ResolutionGuard.InPool guard, Object object, long value) {
        FieldActor f = Snippets.resolveInstanceFieldForWriting(guard);
        holderInitAndPutFieldLong(f, object, value);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutStaticLong(ResolutionGuard.InPool guard, long value) {
        FieldActor f = Snippets.resolveStaticFieldForWriting(guard);
        holderInitAndPutStaticLong(f, value);
    }

    @RUNTIME_ENTRY
    public static long holderInitAndGetFieldLong(FieldActor f, Object object) {
        Snippets.makeHolderInitialized(f);
        return loadLongFieldSnippet(object, f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static long holderInitAndGetStaticLong(FieldActor f) {
        Snippets.makeHolderInitialized(f);
        return loadLongFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutFieldLong(FieldActor f, Object object, long value) {
        Snippets.makeHolderInitialized(f);
        storeLongFieldSnippet(object, f.offset(), f.isVolatile(), value);
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutStaticLong(FieldActor f, long value) {
        Snippets.makeHolderInitialized(f);
        storeLongFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile(), value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static long loadLongHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object) {
        return holderInitAndGetFieldLong(f, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static long loadLongHolderInitStaticSnippet(@Parameter("f") FieldActor f) {
        return holderInitAndGetStaticLong(f);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeLongHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object,
            @Parameter("value") long value) {
        holderInitAndPutFieldLong(f, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeLongHolderInitStaticSnippet(@Parameter("f") FieldActor f,
            @Parameter("value") long value) {
        holderInitAndPutStaticLong(f, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static long loadLongUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object) {
        return resolveAndGetFieldLong(guard, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static long loadLongUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard) {
        return resolveAndGetStaticLong(guard);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeLongUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object,
            @Parameter("value") long value) {
        resolveAndPutFieldLong(guard, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeLongUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard,
            @Parameter("value") long value) {
        resolveAndPutStaticLong(guard, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static double loadDoubleFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_READ);
        }
        double result = TupleAccess.readDouble(object, offset);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
        return result;
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeDoubleFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile, @Parameter("value") double value) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_WRITE);
        }
        TupleAccess.writeDouble(object, offset, value);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
    }

    @RUNTIME_ENTRY
    public static double resolveAndGetFieldDouble(ResolutionGuard.InPool guard, Object object) {
        FieldActor f = Snippets.resolveInstanceFieldForReading(guard);
        return holderInitAndGetFieldDouble(f, object);
    }

    @RUNTIME_ENTRY
    public static double resolveAndGetStaticDouble(ResolutionGuard.InPool guard) {
        FieldActor f = Snippets.resolveStaticFieldForReading(guard);
        return holderInitAndGetStaticDouble(f);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutFieldDouble(ResolutionGuard.InPool guard, Object object, double value) {
        FieldActor f = Snippets.resolveInstanceFieldForWriting(guard);
        holderInitAndPutFieldDouble(f, object, value);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutStaticDouble(ResolutionGuard.InPool guard, double value) {
        FieldActor f = Snippets.resolveStaticFieldForWriting(guard);
        holderInitAndPutStaticDouble(f, value);
    }

    @RUNTIME_ENTRY
    public static double holderInitAndGetFieldDouble(FieldActor f, Object object) {
        Snippets.makeHolderInitialized(f);
        return loadDoubleFieldSnippet(object, f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static double holderInitAndGetStaticDouble(FieldActor f) {
        Snippets.makeHolderInitialized(f);
        return loadDoubleFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutFieldDouble(FieldActor f, Object object, double value) {
        Snippets.makeHolderInitialized(f);
        storeDoubleFieldSnippet(object, f.offset(), f.isVolatile(), value);
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutStaticDouble(FieldActor f, double value) {
        Snippets.makeHolderInitialized(f);
        storeDoubleFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile(), value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static double loadDoubleHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object) {
        return holderInitAndGetFieldDouble(f, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static double loadDoubleHolderInitStaticSnippet(@Parameter("f") FieldActor f) {
        return holderInitAndGetStaticDouble(f);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeDoubleHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object,
            @Parameter("value") double value) {
        holderInitAndPutFieldDouble(f, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeDoubleHolderInitStaticSnippet(@Parameter("f") FieldActor f,
            @Parameter("value") double value) {
        holderInitAndPutStaticDouble(f, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static double loadDoubleUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object) {
        return resolveAndGetFieldDouble(guard, object);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static double loadDoubleUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard) {
        return resolveAndGetStaticDouble(guard);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeDoubleUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object,
            @Parameter("value") double value) {
        resolveAndPutFieldDouble(guard, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeDoubleUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard,
            @Parameter("value") double value) {
        resolveAndPutStaticDouble(guard, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static Object loadObjectFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_READ);
        }
        Object result = TupleAccess.readObject(object, offset);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
        return UnsafeCastNode.unsafeCast(result, StampFactory.forNodeIntrinsic());
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeObjectFieldSnippet(@Parameter("object") Object object,
            @Parameter("offset") int offset, @ConstantParameter("isVolatile") boolean isVolatile, @Parameter("value") Object value) {
        if (isVolatile) {
            memoryBarrier(JMM_PRE_VOLATILE_WRITE);
        }
        TupleAccess.writeObject(object, offset, value);
        if (isVolatile) {
            memoryBarrier(JMM_POST_VOLATILE_READ);
        }
    }

    @RUNTIME_ENTRY
    public static Object resolveAndGetFieldObject(ResolutionGuard.InPool guard, Object object) {
        FieldActor f = Snippets.resolveInstanceFieldForReading(guard);
        return holderInitAndGetFieldObject(f, object);
    }

    @RUNTIME_ENTRY
    public static Object resolveAndGetStaticObject(ResolutionGuard.InPool guard) {
        FieldActor f = Snippets.resolveStaticFieldForReading(guard);
        return holderInitAndGetStaticObject(f);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutFieldObject(ResolutionGuard.InPool guard, Object object, Object value) {
        FieldActor f = Snippets.resolveInstanceFieldForWriting(guard);
        holderInitAndPutFieldObject(f, object, value);
    }

    @RUNTIME_ENTRY
    public static void resolveAndPutStaticObject(ResolutionGuard.InPool guard, Object value) {
        FieldActor f = Snippets.resolveStaticFieldForWriting(guard);
        holderInitAndPutStaticObject(f, value);
    }

    @RUNTIME_ENTRY
    public static Object holderInitAndGetFieldObject(FieldActor f, Object object) {
        Snippets.makeHolderInitialized(f);
        return loadObjectFieldSnippet(object, f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static Object holderInitAndGetStaticObject(FieldActor f) {
        Snippets.makeHolderInitialized(f);
        return loadObjectFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile());
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutFieldObject(FieldActor f, Object object, Object value) {
        Snippets.makeHolderInitialized(f);
        storeObjectFieldSnippet(object, f.offset(), f.isVolatile(), value);
    }

    @RUNTIME_ENTRY
    public static void holderInitAndPutStaticObject(FieldActor f, Object value) {
        Snippets.makeHolderInitialized(f);
        storeObjectFieldSnippet(f.holder().staticTuple(), f.offset(), f.isVolatile(), value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static Object loadObjectHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object) {
        return UnsafeCastNode.unsafeCast(holderInitAndGetFieldObject(f, object), StampFactory.forNodeIntrinsic());
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static Object loadObjectHolderInitStaticSnippet(@Parameter("f") FieldActor f) {
        return UnsafeCastNode.unsafeCast(holderInitAndGetStaticObject(f), StampFactory.forNodeIntrinsic());
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeObjectHolderInitFieldSnippet(@Parameter("f") FieldActor f, @Parameter("object") Object object,
            @Parameter("value") Object value) {
        holderInitAndPutFieldObject(f, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeObjectHolderInitStaticSnippet(@Parameter("f") FieldActor f,
            @Parameter("value") Object value) {
        holderInitAndPutStaticObject(f, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static Object loadObjectUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object) {
        return UnsafeCastNode.unsafeCast(resolveAndGetFieldObject(guard, object), StampFactory.forNodeIntrinsic());
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static Object loadObjectUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard) {
        return UnsafeCastNode.unsafeCast(resolveAndGetStaticObject(guard), StampFactory.forNodeIntrinsic());
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeObjectUnresolvedFieldSnippet(@Parameter("guard") ResolutionGuard.InPool guard, @Parameter("object") Object object,
            @Parameter("value") Object value) {
        resolveAndPutFieldObject(guard, object, value);
    }

    @Snippet(inlining = MaxSnippetInliningPolicy.class)
    public static void storeObjectUnresolvedStaticSnippet(@Parameter("guard") ResolutionGuard.InPool guard,
            @Parameter("value") Object value) {
        resolveAndPutStaticObject(guard, value);
    }

    @HOSTED_ONLY
    private void addSnippets(
            LoadFieldLowering loadFieldLowering, StoreFieldLowering storeFieldLowering,
            LoadUnresolvedFieldLowering loadUnresolvedFieldLowering, StoreUnresolvedFieldLowering storeUnresolvedFieldLowering) {
        loadFieldLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "loadBooleanFieldSnippet"));
        storeFieldLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "storeBooleanFieldSnippet"));
        loadUnresolvedFieldLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "loadBooleanUnresolvedFieldSnippet"));
        loadUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "loadBooleanUnresolvedStaticSnippet"));
        storeUnresolvedFieldLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "storeBooleanUnresolvedFieldSnippet"));
        storeUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "storeBooleanUnresolvedStaticSnippet"));
        loadUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "loadBooleanHolderInitFieldSnippet"));
        loadUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "loadBooleanHolderInitStaticSnippet"));
        storeUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "storeBooleanHolderInitFieldSnippet"));
        storeUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Boolean, findSnippet(FieldSnippets.class, "storeBooleanHolderInitStaticSnippet"));
        loadFieldLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "loadByteFieldSnippet"));
        storeFieldLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "storeByteFieldSnippet"));
        loadUnresolvedFieldLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "loadByteUnresolvedFieldSnippet"));
        loadUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "loadByteUnresolvedStaticSnippet"));
        storeUnresolvedFieldLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "storeByteUnresolvedFieldSnippet"));
        storeUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "storeByteUnresolvedStaticSnippet"));
        loadUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "loadByteHolderInitFieldSnippet"));
        loadUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "loadByteHolderInitStaticSnippet"));
        storeUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "storeByteHolderInitFieldSnippet"));
        storeUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Byte, findSnippet(FieldSnippets.class, "storeByteHolderInitStaticSnippet"));
        loadFieldLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "loadShortFieldSnippet"));
        storeFieldLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "storeShortFieldSnippet"));
        loadUnresolvedFieldLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "loadShortUnresolvedFieldSnippet"));
        loadUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "loadShortUnresolvedStaticSnippet"));
        storeUnresolvedFieldLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "storeShortUnresolvedFieldSnippet"));
        storeUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "storeShortUnresolvedStaticSnippet"));
        loadUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "loadShortHolderInitFieldSnippet"));
        loadUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "loadShortHolderInitStaticSnippet"));
        storeUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "storeShortHolderInitFieldSnippet"));
        storeUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Short, findSnippet(FieldSnippets.class, "storeShortHolderInitStaticSnippet"));
        loadFieldLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "loadCharFieldSnippet"));
        storeFieldLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "storeCharFieldSnippet"));
        loadUnresolvedFieldLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "loadCharUnresolvedFieldSnippet"));
        loadUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "loadCharUnresolvedStaticSnippet"));
        storeUnresolvedFieldLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "storeCharUnresolvedFieldSnippet"));
        storeUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "storeCharUnresolvedStaticSnippet"));
        loadUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "loadCharHolderInitFieldSnippet"));
        loadUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "loadCharHolderInitStaticSnippet"));
        storeUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "storeCharHolderInitFieldSnippet"));
        storeUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Char, findSnippet(FieldSnippets.class, "storeCharHolderInitStaticSnippet"));
        loadFieldLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "loadIntFieldSnippet"));
        storeFieldLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "storeIntFieldSnippet"));
        loadUnresolvedFieldLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "loadIntUnresolvedFieldSnippet"));
        loadUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "loadIntUnresolvedStaticSnippet"));
        storeUnresolvedFieldLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "storeIntUnresolvedFieldSnippet"));
        storeUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "storeIntUnresolvedStaticSnippet"));
        loadUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "loadIntHolderInitFieldSnippet"));
        loadUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "loadIntHolderInitStaticSnippet"));
        storeUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "storeIntHolderInitFieldSnippet"));
        storeUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Int, findSnippet(FieldSnippets.class, "storeIntHolderInitStaticSnippet"));
        loadFieldLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "loadFloatFieldSnippet"));
        storeFieldLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "storeFloatFieldSnippet"));
        loadUnresolvedFieldLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "loadFloatUnresolvedFieldSnippet"));
        loadUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "loadFloatUnresolvedStaticSnippet"));
        storeUnresolvedFieldLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "storeFloatUnresolvedFieldSnippet"));
        storeUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "storeFloatUnresolvedStaticSnippet"));
        loadUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "loadFloatHolderInitFieldSnippet"));
        loadUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "loadFloatHolderInitStaticSnippet"));
        storeUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "storeFloatHolderInitFieldSnippet"));
        storeUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Float, findSnippet(FieldSnippets.class, "storeFloatHolderInitStaticSnippet"));
        loadFieldLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "loadLongFieldSnippet"));
        storeFieldLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "storeLongFieldSnippet"));
        loadUnresolvedFieldLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "loadLongUnresolvedFieldSnippet"));
        loadUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "loadLongUnresolvedStaticSnippet"));
        storeUnresolvedFieldLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "storeLongUnresolvedFieldSnippet"));
        storeUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "storeLongUnresolvedStaticSnippet"));
        loadUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "loadLongHolderInitFieldSnippet"));
        loadUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "loadLongHolderInitStaticSnippet"));
        storeUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "storeLongHolderInitFieldSnippet"));
        storeUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Long, findSnippet(FieldSnippets.class, "storeLongHolderInitStaticSnippet"));
        loadFieldLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "loadDoubleFieldSnippet"));
        storeFieldLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "storeDoubleFieldSnippet"));
        loadUnresolvedFieldLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "loadDoubleUnresolvedFieldSnippet"));
        loadUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "loadDoubleUnresolvedStaticSnippet"));
        storeUnresolvedFieldLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "storeDoubleUnresolvedFieldSnippet"));
        storeUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "storeDoubleUnresolvedStaticSnippet"));
        loadUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "loadDoubleHolderInitFieldSnippet"));
        loadUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "loadDoubleHolderInitStaticSnippet"));
        storeUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "storeDoubleHolderInitFieldSnippet"));
        storeUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Double, findSnippet(FieldSnippets.class, "storeDoubleHolderInitStaticSnippet"));
        loadFieldLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "loadObjectFieldSnippet"));
        storeFieldLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "storeObjectFieldSnippet"));
        loadUnresolvedFieldLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "loadObjectUnresolvedFieldSnippet"));
        loadUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "loadObjectUnresolvedStaticSnippet"));
        storeUnresolvedFieldLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "storeObjectUnresolvedFieldSnippet"));
        storeUnresolvedFieldLowering.staticFieldLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "storeObjectUnresolvedStaticSnippet"));
        loadUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "loadObjectHolderInitFieldSnippet"));
        loadUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "loadObjectHolderInitStaticSnippet"));
        storeUnresolvedFieldLowering.initHolderFieldLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "storeObjectHolderInitFieldSnippet"));
        storeUnresolvedFieldLowering.initHolderStaticLowering.setSnippet(Kind.Object, findSnippet(FieldSnippets.class, "storeObjectHolderInitStaticSnippet"));
    }
// END GENERATED CODE

}
